# [운영체제] 8. 쓰레드(Thread)



## 1. 프로세스와 생성과 종료

프로세스는 프로세스에 의해 만들어진다. 컴퓨터가 부팅이 되면 운영체제가 메모리에 올라오는데 운영체제가 처음으로 수행하는 일 중에 하나는 **최초의 프로세스를 생성**하는 것이다. 이렇게 처음 만들어진 프로세스가 다른 프로세스를 만들고 그 프로세스가 또 다른 프로세스를 만드는 과정을 반복한다. (자료구조 트리와 같다.)

![img](https://user-images.githubusercontent.com/34755287/53879677-5f302f00-4052-11e9-89ea-72135b020d12.png)

위와 같이 최초의 프로세스는 **Init**이다. 이 이름은 운영체제마다 다르고, init은 UNIX 운영체제 기준 이름이다. 여기서 여러 다른 프로세스들이 생성되면 위와 같은 그림처럼 **트리 모양**으로 나타낼 수 있다.여기서 프로세스를 생성한 쪽을 **부모 프로세스**, 만들어진 프로세스를 **자식 프로세스**라고 한다. 같은 부모를 갖는 자식 프로세스 끼리는 서로 Sibling(형제) 프로세스라고 한다.

프로세스는 각각 고유의 번호를 갖는데 이를 **PID(Process Identifirer)**라고 한다. PID는 일반적으로 정수형(integer)으로 표현한다. PPID는 부모의 PID를 말한다.



### 1.2. 프로세스 생성

새로운 프로세스를 만드는 시스템 콜이 존재하는데, 이는 `fork()` 라 한다. 만들어진 프로세스에서 어떠한 파일을 실행하려면 `exec()` 시스템 콜을 사용한다.

### 1.3. 프로세스 종료

프로세스를 종료하는 시스템 콜은 `exit()` 이다. 한 프로세스가 종료되면 해당 프로세스가 사용한 모든 자원(메모리, 파일, I/O 등)을 회수해야한다. 이러한 회수된 자원과 권한은 모두 운영체제로 되돌아가야한다.



## 2. Thread (쓰레드)

쓰레드는 **프로그램 내부의 흐름**이다.

``` c++
int main(){
  int n=0;
  int m=6;
  cout<<"hi";
  while(n<m)
    n++;
  cout<<"bye";
}
```

위와 같은 코드는 하나의 흐름을 가지고 있고 이를 쓰레드라고 부른다. . 일반적으로 하나의 프로그램은 하나의 쓰레드를 갖는다.



### 2.1. Multithreads (다중 쓰레드)

하나의 프로그램에 쓰레드가 **2개 이상** 존재하는 것을 다중 쓰레드라고 한다. 이렇게 한 프로그램에 여러 개의 쓰레드 즉, 흐름이 있을 수 있는 이유는 쓰레드가 빠른 시간 간격으로 스위칭되기 때문이다. 이러한 동작으로 사용자는 여러 쓰레드가 동시에 실행되는 것처럼 보인다.

이처럼 CPU가 하나인 환경에서 여러 쓰레드가 스위칭에 의해 동시에 수행되는 효과를 **concurrent**라 한다. 반면에 여러 CPU 환경에서 여러 쓰레드가 실제로 동시에 수행되는 것은 **simultaneous**라고 한다.

- Web brower : 화면 출력하는 쓰레드 + 데이터 읽어오는 쓰레드
- Word processor: 화면 출력하는 쓰레드 + 키보드 입력 받는 쓰레드 + 철자/문법 오류 확인 쓰레드
- 음악 연주기, 동영상 플레이어, Eclipse IDE...

이전의 CPU 스케줄링에서 하나의 프로세스가 수행하다가 다른 프로세스로 넘어간다고 하였는데, 이는 예전의 방식이다. 현재 운영체제에서는 대부분 다중 쓰레드를 지원하기 때문에 하나의 프로세스 안에서 여러 쓰레드를 수행하다가 다른 프로세스로 넘어가서 그 프로세스의 쓰레드를 수행한다. 그러므로 현대 운영체제의 **context switching 단위는 프로세스가 아닌 쓰레드 단위**이다.



### 2.2. Thread VS Process

한 프로세스에는 기본적으로 하나의 쓰레드가 존재한다. 프로세스는 **code, data, 메모리 공간**이 존재하는데, 이는 여러 쓰레드가 공유한다. 이외에도 프로세스의 자원인 file, I/O 등은 여러 쓰레드가 공유하지만, 각 쓰레드가 고유하게 가지고 있는 것은 **PC(Program Counter), SP(Stack Pointer), registers, stack** 등이 있다.







## Reference

- [운영체제 KOCW 양희재 교수님 강의](http://www.kocw.net/home/search/kemView.do?kemId=978503)
- [Operation System Concepts 9th](http://www.kyobobook.co.kr/product/detailViewEng.laf?ejkGb=ENG&mallGb=ENG&barcode=9781118093757&orderClick=LAG&Kc=)
- [SUNGBUM PARK 블로그](https://velog.io/@codemcd/운영체제OS-7.-쓰레드Thread)

